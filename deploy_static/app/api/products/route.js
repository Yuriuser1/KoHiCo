"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},30775:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>A,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{GET:()=>d,dynamic:()=>p});var s=r(79182),n=r(72007),i=r(56719),o=r(93442),c=r(83178);let p="force-dynamic";async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("search")||"",a=t.get("category")?.split(",").filter(Boolean)||[],s=t.get("brand")?.split(",").filter(Boolean)||[],n=parseInt(t.get("minPrice")||"0"),i=parseInt(t.get("maxPrice")||"999999"),p=t.get("sort")||"newest",d="true"===t.get("inStock"),u="true"===t.get("promo"),l={AND:[]};r&&l.AND.push({OR:[{name:{contains:r,mode:"insensitive"}},{description:{contains:r,mode:"insensitive"}},{shortDescription:{contains:r,mode:"insensitive"}},{brand:{name:{contains:r,mode:"insensitive"}}}]}),a.length>0&&l.AND.push({category:{slug:{in:a}}}),s.length>0&&l.AND.push({brand:{slug:{in:s}}}),(n>0||i<999999)&&l.AND.push({price:{gte:n,lte:i}}),d&&l.AND.push({inStock:!0}),u&&l.AND.push({isPromo:!0});let m={createdAt:"desc"};switch(p){case"price-asc":m={price:"asc"};break;case"price-desc":m={price:"desc"};break;case"name":m={name:"asc"};break;case"featured":m=[{isFeatured:"desc"},{createdAt:"desc"}];break;default:m={createdAt:"desc"}}let g=await c._.product.findMany({where:l.AND.length>0?l:{},include:{brand:!0,category:!0,images:!0},orderBy:m,take:50}),h=await c._.product.count({where:l.AND.length>0?l:{}}),[A,y]=await Promise.all([c._.category.findMany({orderBy:{name:"asc"}}),c._.brand.findMany({orderBy:{name:"asc"}})]);return o.NextResponse.json({products:g,categories:A,brands:y,total:h})}catch(e){return console.error("Error fetching products:",e),o.NextResponse.json({error:"Ошибка загрузки товаров"},{status:500})}}let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/home/ubuntu/kohico_shop/app/app/api/products/route.ts",nextConfigOutput:"export",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:g}=u,h="/api/products/route";function A(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},83178:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[885,609],()=>r(30775));module.exports=a})();